<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 bbplot | 进阶 R 图形</title>
  <meta name="description" content="4 bbplot | 进阶 R 图形" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="4 bbplot | 进阶 R 图形" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 bbplot | 进阶 R 图形" />
  
  
  

<meta name="author" content="Maxine" />


<meta name="date" content="2019-10-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="others.html"/>
<link rel="next" href="ggdark.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">进阶 R 图形</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I 几何对象</b></span></li>
<li class="chapter" data-level="1" data-path="Ridge.html"><a href="Ridge.html"><i class="fa fa-check"></i><b>1</b> 山峦图</a><ul>
<li class="chapter" data-level="1.1" data-path="Ridge.html"><a href="Ridge.html#简介"><i class="fa fa-check"></i><b>1.1</b> 简介</a></li>
<li class="chapter" data-level="1.2" data-path="Ridge.html"><a href="Ridge.html#ridgeline"><i class="fa fa-check"></i><b>1.2</b> <code>ridgeline</code></a></li>
<li class="chapter" data-level="1.3" data-path="Ridge.html"><a href="Ridge.html#density_ridges"><i class="fa fa-check"></i><b>1.3</b> <code>density_ridges()</code></a></li>
<li class="chapter" data-level="1.4" data-path="Ridge.html"><a href="Ridge.html#映射填充色-varying-fill-colors-along-the-x-axis"><i class="fa fa-check"></i><b>1.4</b> 映射填充色 (Varying fill colors along the x axis)</a></li>
<li class="chapter" data-level="1.5" data-path="Ridge.html"><a href="Ridge.html#统计变换"><i class="fa fa-check"></i><b>1.5</b> 统计变换</a><ul>
<li class="chapter" data-level="1.5.1" data-path="Ridge.html"><a href="Ridge.html#分位数线"><i class="fa fa-check"></i><b>1.5.1</b> 分位数线</a></li>
<li class="chapter" data-level="1.5.2" data-path="Ridge.html"><a href="Ridge.html#添加抖动点"><i class="fa fa-check"></i><b>1.5.2</b> 添加抖动点</a></li>
<li class="chapter" data-level="1.5.3" data-path="Ridge.html"><a href="Ridge.html#其他统计变换"><i class="fa fa-check"></i><b>1.5.3</b> 其他统计变换</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="Ridge.html"><a href="Ridge.html#主题"><i class="fa fa-check"></i><b>1.6</b> 主题</a></li>
<li class="chapter" data-level="1.7" data-path="Ridge.html"><a href="Ridge.html#循环标度"><i class="fa fa-check"></i><b>1.7</b> 循环标度</a></li>
<li class="chapter" data-level="1.8" data-path="Ridge.html"><a href="Ridge.html#实例澳大利亚运动员身高"><i class="fa fa-check"></i><b>1.8</b> 实例：澳大利亚运动员身高</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ggpubr.html"><a href="ggpubr.html"><i class="fa fa-check"></i><b>2</b> <code>ggpubr</code></a><ul>
<li class="chapter" data-level="2.1" data-path="ggpubr.html"><a href="ggpubr.html#ggbarplot"><i class="fa fa-check"></i><b>2.1</b> <code>ggbarplot</code></a></li>
<li class="chapter" data-level="2.2" data-path="ggpubr.html"><a href="ggpubr.html#ggdotchart"><i class="fa fa-check"></i><b>2.2</b> <code>ggdotchart</code></a></li>
<li class="chapter" data-level="2.3" data-path="ggpubr.html"><a href="ggpubr.html#ggscatter"><i class="fa fa-check"></i><b>2.3</b> <code>ggscatter</code></a></li>
<li class="chapter" data-level="2.4" data-path="ggpubr.html"><a href="ggpubr.html#ggscatterhist"><i class="fa fa-check"></i><b>2.4</b> <code>ggscatterhist</code></a></li>
<li class="chapter" data-level="2.5" data-path="ggpubr.html"><a href="ggpubr.html#ggarrange"><i class="fa fa-check"></i><b>2.5</b> <code>ggarrange</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="others.html"><a href="others.html"><i class="fa fa-check"></i><b>3</b> 其他</a><ul>
<li class="chapter" data-level="3.1" data-path="others.html"><a href="others.html#Raincloud"><i class="fa fa-check"></i><b>3.1</b> 云雨图</a></li>
<li class="chapter" data-level="3.2" data-path="others.html"><a href="others.html#坡度图"><i class="fa fa-check"></i><b>3.2</b> 坡度图</a></li>
</ul></li>
<li class="part"><span><b>II 主题与排版</b></span></li>
<li class="chapter" data-level="4" data-path="bbplot.html"><a href="bbplot.html"><i class="fa fa-check"></i><b>4</b> bbplot</a><ul>
<li class="chapter" data-level="4.1" data-path="bbplot.html"><a href="bbplot.html#简介bbc_style-和-finalize_plot"><i class="fa fa-check"></i><b>4.1</b> 简介：<code>bbc_style()</code> 和 <code>finalize_plot()</code></a></li>
<li class="chapter" data-level="4.2" data-path="bbplot.html"><a href="bbplot.html#折线图"><i class="fa fa-check"></i><b>4.2</b> 折线图</a></li>
<li class="chapter" data-level="4.3" data-path="bbplot.html"><a href="bbplot.html#条形图"><i class="fa fa-check"></i><b>4.3</b> 条形图</a><ul>
<li class="chapter" data-level="4.3.1" data-path="bbplot.html"><a href="bbplot.html#堆积条形图"><i class="fa fa-check"></i><b>4.3.1</b> 堆积条形图</a></li>
<li class="chapter" data-level="4.3.2" data-path="bbplot.html"><a href="bbplot.html#簇状条形图"><i class="fa fa-check"></i><b>4.3.2</b> 簇状条形图</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="bbplot.html"><a href="bbplot.html#哑铃图"><i class="fa fa-check"></i><b>4.4</b> 哑铃图</a></li>
<li class="chapter" data-level="4.5" data-path="bbplot.html"><a href="bbplot.html#直方图"><i class="fa fa-check"></i><b>4.5</b> 直方图</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggdark.html"><a href="ggdark.html"><i class="fa fa-check"></i><b>5</b> ggdark</a><ul>
<li class="chapter" data-level="5.1" data-path="ggdark.html"><a href="ggdark.html#dark_mode"><i class="fa fa-check"></i><b>5.1</b> <code>dark_mode</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="patchwork.html"><a href="patchwork.html"><i class="fa fa-check"></i><b>6</b> <code>patchwork</code></a><ul>
<li class="chapter" data-level="6.1" data-path="patchwork.html"><a href="patchwork.html#布局和嵌套"><i class="fa fa-check"></i><b>6.1</b> 布局和嵌套</a></li>
<li class="chapter" data-level="6.2" data-path="patchwork.html"><a href="patchwork.html#注解"><i class="fa fa-check"></i><b>6.2</b> 注解</a></li>
<li class="chapter" data-level="6.3" data-path="patchwork.html"><a href="patchwork.html#运算符"><i class="fa fa-check"></i><b>6.3</b> 运算符</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ggthemes.html"><a href="ggthemes.html"><i class="fa fa-check"></i><b>7</b> <code>ggthemes</code></a></li>
<li class="part"><span><b>III 实例</b></span></li>
<li class="chapter" data-level="8" data-path="Econmist.html"><a href="Econmist.html"><i class="fa fa-check"></i><b>8</b> 经济学人：Corruption and human development</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">written with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">进阶 R 图形</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bbplot" class="section level1">
<h1><span class="header-section-number">4</span> bbplot</h1>
<p>参考 <a href="https://bbc.github.io/rcookbook/" class="uri">https://bbc.github.io/rcookbook/</a></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb72-2" title="2"><span class="kw">library</span>(bbplot)</a></code></pre></div>
<div id="简介bbc_style-和-finalize_plot" class="section level2">
<h2><span class="header-section-number">4.1</span> 简介：<code>bbc_style()</code> 和 <code>finalize_plot()</code></h2>
<p><code>bbplot</code> 包中有两个函数：<code>bbc_style()</code> 和 <code>finalise_plot()</code></p>
<p><code>bbc_style()</code> 封装了一些 ggplot2 中的主题设置，创建 BBC 风格的字号、字体、颜色、标度、边距等组件，不需要传入任何参数，这里列出几项它的重要设定：</p>
<ul>
<li>设置了图形标题、副标题、坐标轴刻度的字体、字号（调大）和风格（粗体），取消了坐标轴标题<br />
</li>
<li>将图例移到上方，取消图例的标题和背景<br />
</li>
<li>取消 y 方向的刻度线(<code>panel.grid.major.x = element_blank()</code>), 修改 x 方向的刻度线颜色(<code>panel.grid.major.y = element_line(color="#cbcbcb")</code>)</li>
<li>取消绘图区背景 (<code>panel.background = element_blank()</code>)，将分面系统中的背景填充为白色</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="co">## bbc_style() 源码</span></a>
<a class="sourceLine" id="cb73-2" title="2">xfun<span class="op">::</span><span class="kw">file_string</span>(<span class="st">&quot;examples</span><span class="ch">\\</span><span class="st">bbc_style.R&quot;</span>)</a></code></pre></div>
<pre><code>## 
## 
## bbc_style &lt;- function() {
##   font &lt;- &quot;Helvetica&quot;
## 
##   ggplot2::theme(
## 
##     #Text format:
##     #This sets the font, size, type and colour of text for the chart&#39;s title
##     plot.title = ggplot2::element_text(family=font,
##                                        size=28,
##                                        face=&quot;bold&quot;,
##                                        color=&quot;#222222&quot;),
##     #This sets the font, size, type and colour of text for the chart&#39;s subtitle, as well as setting a margin between the title and the subtitle
##     plot.subtitle = ggplot2::element_text(family=font,
##                                           size=22,
##                                           margin=ggplot2::margin(9,0,9,0)),
##     plot.caption = ggplot2::element_blank(),
##     #This leaves the caption text element empty, because it is set elsewhere in the finalise plot function
## 
##     #Legend format
##     #This sets the position and alignment of the legend, removes a title and backround for it and sets the requirements for any text within the legend. The legend may often need some more manual tweaking when it comes to its exact position based on the plot coordinates.
##     legend.position = &quot;top&quot;,
##     legend.text.align = 0,
##     legend.background = ggplot2::element_blank(),
##     legend.title = ggplot2::element_blank(),
##     legend.key = ggplot2::element_blank(),
##     legend.text = ggplot2::element_text(family=font,
##                                         size=18,
##                                         color=&quot;#222222&quot;),
## 
##     #Axis format
##     #This sets the text font, size and colour for the axis test, as well as setting the margins and removes lines and ticks. In some cases, axis lines and axis ticks are things we would want to have in the chart - the cookbook shows examples of how to do so.
##     axis.title = ggplot2::element_blank(),
##     axis.text = ggplot2::element_text(family=font,
##                                       size=18,
##                                       color=&quot;#222222&quot;),
##     axis.text.x = ggplot2::element_text(margin=ggplot2::margin(5, b = 10)),
##     axis.ticks = ggplot2::element_blank(),
##     axis.line = ggplot2::element_blank(),
## 
##     #Grid lines
##     #This removes all minor gridlines and adds major y gridlines. In many cases you will want to change this to remove y gridlines and add x gridlines. The cookbook shows you examples for doing so
##     panel.grid.minor = ggplot2::element_blank(),
##     panel.grid.major.y = ggplot2::element_line(color=&quot;#cbcbcb&quot;),
##     panel.grid.major.x = ggplot2::element_blank(),
## 
##     #Blank background
##     #This sets the panel background as blank, removing the standard grey ggplot background colour from the plot
##     panel.background = ggplot2::element_blank(),
## 
##     #Strip background (#This sets the panel background for facet-wrapped plots to white, removing the standard grey ggplot background colour and sets the title size of the facet-wrap title to font size 22)
##     strip.background = ggplot2::element_rect(fill=&quot;white&quot;),
##     strip.text = ggplot2::element_text(size  = 22,  hjust = 0)
##   )
## }</code></pre>
<blockquote>
<p>由于 Windows 系统没有 Helvetica 字体，使用 bbc_sytle() 时会触发警告 “<br />
font family not found in Windows font database”。可以用 windowsFonts(Helvetica = “TT Arial”) 使 R 用 Arial 字体代替 Helvetica</p>
</blockquote>
<p>需要注意的是折线图中的线条或者条形图中条形的颜色不由 <code>bbc_style()</code> 函数定制，需要使用标准的 ggplot 绘图函数指定。</p>
<p><code>finalise_plot()</code> 是在图表发布前进行最后加工的函数，能够使图表的标题和副标题左对齐、添加信息来源、在图表右下脚添加照片。它还能将图表保存至指定的位置。这个函数有5个参数：</p>
<ul>
<li><code>plot_name</code>: 变量名，如我们经常用变量 <code>p</code> 来存储 ggplot 图形<br />
</li>
<li><code>source</code>:需要在图表左下角暂时的来源文字，需要在文字前先打上 “Source:”,比如 `source = “Source: ONS”。<br />
</li>
<li><code>svae_filepath</code>:图表的保存路径，需要包括.png 后缀。<br />
</li>
<li><code>width_pixels</code>:默认 640 px。hieght_pixels:，默认 450 px。<br />
</li>
<li><code>logo_image_path</code>:指定在图表右下角需要展示的 logo 保存的位置。默认是一个 png 格式的占位文件，颜色和图表的背景色一样。如果你不需要展示 logo， 则无需调整此参数。当你想给图表增加 logo 时，通过此参数指定 logo 的位置即可。</li>
</ul>
</div>
<div id="折线图" class="section level2">
<h2><span class="header-section-number">4.2</span> 折线图</h2>
<p>使用 gapminder 数据集作一些试验：</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb75-2" title="2">gapminder</a></code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # ... with 1,694 more rows</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="co">#Prepare data</span></a>
<a class="sourceLine" id="cb77-2" title="2"><span class="kw">windowsFonts</span>(<span class="dt">Helvetica =</span> <span class="st">&quot;TT Arial&quot;</span>)</a>
<a class="sourceLine" id="cb77-3" title="3">line_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-4" title="4"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;China&quot;</span>) </a>
<a class="sourceLine" id="cb77-5" title="5"></a>
<a class="sourceLine" id="cb77-6" title="6"><span class="co">#Make plot</span></a>
<a class="sourceLine" id="cb77-7" title="7">line &lt;-<span class="st"> </span><span class="kw">ggplot</span>(line_df, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-8" title="8"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;#1380A1&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-9" title="9"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;#333333&quot;</span>)  <span class="co">## 在 y = 0 处做一个标记是好习惯</span></a>
<a class="sourceLine" id="cb77-10" title="10">line</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.svg" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1"><span class="co">## 添加 bbc_style()</span></a>
<a class="sourceLine" id="cb78-2" title="2">line <span class="op">+</span><span class="st"> </span><span class="kw">bbc_style</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-2.svg" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1"><span class="co">## </span></a>
<a class="sourceLine" id="cb79-2" title="2">line <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-3" title="3"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb79-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Living longer&quot;</span>,</a>
<a class="sourceLine" id="cb79-5" title="5">       <span class="dt">subtitle =</span> <span class="st">&quot;Life expectancy in China 1952-2007&quot;</span>) </a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-3.svg" width="672" /></p>
<p>下面绘制一个多重折线图：</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">multiple_line_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-2" title="2"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;China&quot;</span> <span class="op">|</span><span class="st"> </span>country <span class="op">==</span><span class="st"> &quot;United States&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">multiple_line &lt;-<span class="st"> </span><span class="kw">ggplot</span>(multiple_line_df) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(year, lifeExp, <span class="dt">color =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-3" title="3"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;#333333&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-4" title="4"><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#FAAB18&quot;</span>, <span class="st">&quot;#1380A1&quot;</span>)) </a>
<a class="sourceLine" id="cb81-5" title="5"></a>
<a class="sourceLine" id="cb81-6" title="6">multiple_line</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.svg" width="672" /></p>
<p>添加 <code>bbc_style()</code> 和标题文字：</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">multiple_line <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb82-2" title="2"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb82-3" title="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Living longer&quot;</span>,</a>
<a class="sourceLine" id="cb82-4" title="4">       <span class="dt">subtitle =</span> <span class="st">&quot;Life expectancy in China and the US&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.svg" width="672" /></p>
<p>假使这是我们最终想要发布的版本，可以用 <code>finalise_plot()</code> 加工并保存：</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">multiple_line &lt;-<span class="st"> </span>multiple_line <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-2" title="2"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-3" title="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Living longer&quot;</span>,</a>
<a class="sourceLine" id="cb83-4" title="4">       <span class="dt">subtitle =</span> <span class="st">&quot;Life expectancy in China and the US&quot;</span>)</a>
<a class="sourceLine" id="cb83-5" title="5"></a>
<a class="sourceLine" id="cb83-6" title="6"><span class="kw">finalise_plot</span>(<span class="dt">plot_name =</span> multiple_line, <span class="dt">source_name =</span> <span class="st">&quot;Source: Gapminder&quot;</span>,</a>
<a class="sourceLine" id="cb83-7" title="7">              <span class="dt">save_filepath =</span> <span class="st">&quot;images</span><span class="ch">\\</span><span class="st">line chart.png&quot;</span>,</a>
<a class="sourceLine" id="cb83-8" title="8">              <span class="dt">logo_image_path =</span> <span class="st">&quot;images</span><span class="ch">\\</span><span class="st">caution.png&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.svg" width="672" /></p>
<p>随后我们可以在 images 文件夹中找到这个 png 文件：</p>
<p><img src="images/finalise_plot.png" /></p>
</div>
<div id="条形图" class="section level2">
<h2><span class="header-section-number">4.3</span> 条形图</h2>
<p>依旧使用 gapminder 数据：</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">bar_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-2" title="2"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span> <span class="op">&amp;</span><span class="st"> </span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-4" title="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb84-5" title="5"></a>
<a class="sourceLine" id="cb84-6" title="6">bar_df</a></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##   country   continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Reunion   Africa     2007    76.4   798094     7670.
## 2 Libya     Africa     2007    74.0  6036914    12057.
## 3 Tunisia   Africa     2007    73.9 10276158     7093.
## 4 Mauritius Africa     2007    72.8  1250882    10957.
## 5 Algeria   Africa     2007    72.3 33333216     6223.</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="co">## 绘制条形图 </span></a>
<a class="sourceLine" id="cb86-2" title="2">bars &lt;-<span class="st"> </span><span class="kw">ggplot</span>(bar_df, <span class="kw">aes</span>(<span class="dt">x =</span> country, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, </a>
<a class="sourceLine" id="cb86-4" title="4">           <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>, </a>
<a class="sourceLine" id="cb86-5" title="5">           <span class="dt">fill=</span><span class="st">&quot;#1380A1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-6" title="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;#333333&quot;</span>) </a>
<a class="sourceLine" id="cb86-7" title="7"></a>
<a class="sourceLine" id="cb86-8" title="8">bars</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-1.svg" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1"><span class="co">## 添加 bbc_style() 并添加标题</span></a>
<a class="sourceLine" id="cb87-2" title="2">bars <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-3" title="3"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb87-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Reunion is the highest&quot;</span>,</a>
<a class="sourceLine" id="cb87-5" title="5">       <span class="dt">subtitle =</span> <span class="st">&quot;Highest African life expectancy, 2007&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-2.svg" width="672" /></p>
<div id="堆积条形图" class="section level3">
<h3><span class="header-section-number">4.3.1</span> 堆积条形图</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="co">#prepare data</span></a>
<a class="sourceLine" id="cb88-2" title="2">stacked_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-3" title="3"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lifeExpGrouped =</span> <span class="kw">cut</span>(lifeExp, </a>
<a class="sourceLine" id="cb88-5" title="5">                    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">65</span>, <span class="dv">80</span>, <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb88-6" title="6">                    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Under 50&quot;</span>, <span class="st">&quot;50-65&quot;</span>, <span class="st">&quot;65-80&quot;</span>, <span class="st">&quot;80+&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(continent, lifeExpGrouped) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-8" title="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">continentPop =</span> <span class="kw">sum</span>(<span class="kw">as.numeric</span>(pop)))</a>
<a class="sourceLine" id="cb88-9" title="9"></a>
<a class="sourceLine" id="cb88-10" title="10">stacked_df</a></code></pre></div>
<pre><code>## # A tibble: 13 x 3
## # Groups:   continent [5]
##    continent lifeExpGrouped continentPop
##    &lt;fct&gt;     &lt;fct&gt;                 &lt;dbl&gt;
##  1 Africa    Under 50          376100713
##  2 Africa    50-65             386811458
##  3 Africa    65-80             166627521
##  4 Americas  50-65               8502814
##  5 Americas  65-80             856978229
##  6 Americas  80+                33390141
##  7 Asia      Under 50           31889923
##  8 Asia      50-65            1401351679
##  9 Asia      65-80            2237837162
## 10 Asia      80+               140875063
## 11 Europe    65-80             404903083
## 12 Europe    80+               181195446
## 13 Oceania   80+                24549947</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="co">#set order of stacks by changing factor levels</span></a>
<a class="sourceLine" id="cb90-2" title="2">stacked_df<span class="op">$</span>lifeExpGrouped =<span class="st"> </span><span class="kw">factor</span>(stacked_df<span class="op">$</span>lifeExpGrouped, </a>
<a class="sourceLine" id="cb90-3" title="3">                                   <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(stacked_df<span class="op">$</span>lifeExpGrouped)))</a>
<a class="sourceLine" id="cb90-4" title="4"></a>
<a class="sourceLine" id="cb90-5" title="5"><span class="co">## create plot</span></a>
<a class="sourceLine" id="cb90-6" title="6">stacked_bars &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> stacked_df, <span class="kw">aes</span>(<span class="dt">x =</span> continent,</a>
<a class="sourceLine" id="cb90-7" title="7">                           <span class="dt">y =</span> continentPop,</a>
<a class="sourceLine" id="cb90-8" title="8">                           <span class="dt">fill =</span> lifeExpGrouped)) <span class="op">+</span></a>
<a class="sourceLine" id="cb90-9" title="9"><span class="st">                  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, </a>
<a class="sourceLine" id="cb90-10" title="10">                          <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</a>
<a class="sourceLine" id="cb90-11" title="11"></a>
<a class="sourceLine" id="cb90-12" title="12">stacked_bars</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.svg" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1"><span class="co">## 添加 bbc_style()</span></a>
<a class="sourceLine" id="cb91-2" title="2">stacked_bars <span class="op">+</span><span class="st"> </span><span class="kw">bbc_style</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-2.svg" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1"><span class="co">## 完善  </span></a>
<a class="sourceLine" id="cb92-2" title="2"></a>
<a class="sourceLine" id="cb92-3" title="3">stacked_bars <span class="op">+</span></a>
<a class="sourceLine" id="cb92-4" title="4"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb92-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-6" title="6"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-7" title="7"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;#333333&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;How life expectancy varies&quot;</span>,</a>
<a class="sourceLine" id="cb92-9" title="9">       <span class="dt">subtitle =</span> <span class="st">&quot;% of population by life expectancy band, 2007&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-10" title="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.justification =</span> <span class="st">&quot;left&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb92-11" title="11"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-3.svg" width="672" /></p>
</div>
<div id="簇状条形图" class="section level3">
<h3><span class="header-section-number">4.3.2</span> 簇状条形图</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1"><span class="co">## prepare data</span></a>
<a class="sourceLine" id="cb93-2" title="2">grouped_bar_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="st">    </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1967</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-4" title="4"><span class="st">    </span><span class="kw">select</span>(country, year, lifeExp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-5" title="5"><span class="st">    </span><span class="kw">spread</span>(year, lifeExp) <span class="op">%&gt;%</span><span class="st">     </span><span class="co">## 为计算 gap</span></a>
<a class="sourceLine" id="cb93-6" title="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gap =</span> <span class="st">`</span><span class="dt">2007</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">1967</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-7" title="7"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(gap)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-8" title="8"><span class="st">    </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-9" title="9"><span class="st">    </span><span class="kw">gather</span>(year, lifeExp, <span class="op">-</span>country, <span class="op">-</span>gap)</a>
<a class="sourceLine" id="cb93-10" title="10"></a>
<a class="sourceLine" id="cb93-11" title="11">grouped_bar_df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    country       gap year  lifeExp
##    &lt;fct&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 Oman         28.7 1967     47.0
##  2 Vietnam      26.4 1967     47.8
##  3 Yemen, Rep.  25.7 1967     37.0
##  4 Indonesia    24.7 1967     46.0
##  5 Libya        23.7 1967     50.2
##  6 Oman         28.7 2007     75.6
##  7 Vietnam      26.4 2007     74.2
##  8 Yemen, Rep.  25.7 2007     62.7
##  9 Indonesia    24.7 2007     70.6
## 10 Libya        23.7 2007     74.0</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">grouped_bars &lt;-<span class="st"> </span><span class="kw">ggplot</span>(grouped_bar_df) <span class="op">+</span></a>
<a class="sourceLine" id="cb95-2" title="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(country, lifeExp, <span class="dt">fill =</span> year),</a>
<a class="sourceLine" id="cb95-3" title="3">           <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb95-4" title="4"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;#333333&quot;</span>)</a>
<a class="sourceLine" id="cb95-5" title="5"></a>
<a class="sourceLine" id="cb95-6" title="6">grouped_bars </a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-1.svg" width="672" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="co">## 添加 bbc_style()</span></a>
<a class="sourceLine" id="cb96-2" title="2">grouped_bars <span class="op">+</span><span class="st"> </span><span class="kw">bbc_style</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-2.svg" width="672" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="co">## 完善  </span></a>
<a class="sourceLine" id="cb97-2" title="2">grouped_bars <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-3" title="3"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb97-4" title="4"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#1380A1&quot;</span>, <span class="st">&quot;#FAAB18&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;We&#39;re living longer&quot;</span>,</a>
<a class="sourceLine" id="cb97-6" title="6">       <span class="dt">subtitle =</span> <span class="st">&quot;Biggest life expectancy rise, 1967-2007&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-7" title="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>))  <span class="co">## bbc_style() 默认设置字号为 18</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-3.svg" width="672" /></p>
</div>
</div>
<div id="哑铃图" class="section level2">
<h2><span class="header-section-number">4.4</span> 哑铃图</h2>
<p>这里哑铃图的作法用到了 ggalt 包中便捷的 <code>geom_dumbbell()</code> 函数：</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="co">## prepare data</span></a>
<a class="sourceLine" id="cb98-2" title="2"><span class="kw">library</span>(ggalt)</a>
<a class="sourceLine" id="cb98-3" title="3">dumbbell_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-4" title="4"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1967</span> <span class="op">|</span><span class="st"> </span>year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-5" title="5"><span class="st">  </span><span class="kw">select</span>(country, year, lifeExp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-6" title="6"><span class="st">  </span><span class="kw">spread</span>(year, lifeExp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gap =</span> <span class="st">`</span><span class="dt">2007</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">1967</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-8" title="8"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(gap)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-9" title="9"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)   <span class="co">## 这里为了使用 geom_dumbbell() 没有再使用聚合函数</span></a>
<a class="sourceLine" id="cb98-10" title="10"></a>
<a class="sourceLine" id="cb98-11" title="11">dumbbell_df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    country      `1967` `2007`   gap
##    &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 Oman           47.0   75.6  28.7
##  2 Vietnam        47.8   74.2  26.4
##  3 Yemen, Rep.    37.0   62.7  25.7
##  4 Indonesia      46.0   70.6  24.7
##  5 Libya          50.2   74.0  23.7
##  6 Gambia         35.9   59.4  23.6
##  7 Saudi Arabia   49.9   72.8  22.9
##  8 Nepal          41.5   63.8  22.3
##  9 Egypt          49.3   71.3  22.0
## 10 Tunisia        52.1   73.9  21.9</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="co">## create plot</span></a>
<a class="sourceLine" id="cb100-2" title="2">dumbbell &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dumbbell_df, </a>
<a class="sourceLine" id="cb100-3" title="3">                   <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">1967</span><span class="st">`</span>, <span class="dt">xend =</span> <span class="st">`</span><span class="dt">2007</span><span class="st">`</span>, <span class="dt">y =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb100-4" title="4"><span class="st">  </span><span class="kw">geom_dumbbell</span>(<span class="dt">colour =</span> <span class="st">&quot;#dddddd&quot;</span>,</a>
<a class="sourceLine" id="cb100-5" title="5">                <span class="dt">size =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb100-6" title="6">                <span class="dt">colour_x =</span> <span class="st">&quot;#FAAB18&quot;</span>,</a>
<a class="sourceLine" id="cb100-7" title="7">                <span class="dt">colour_xend =</span> <span class="st">&quot;#1380A1&quot;</span> )</a>
<a class="sourceLine" id="cb100-8" title="8"></a>
<a class="sourceLine" id="cb100-9" title="9">dumbbell</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-1.svg" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1"><span class="co">## 添加 bbc_style()</span></a>
<a class="sourceLine" id="cb101-2" title="2"></a>
<a class="sourceLine" id="cb101-3" title="3">dumbbell <span class="op">+</span><span class="st"> </span><span class="kw">bbc_style</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-2.svg" width="672" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="co">## 成图 </span></a>
<a class="sourceLine" id="cb102-2" title="2">dumbbell <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-3" title="3"><span class="st">  </span><span class="kw">bbc_style</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb102-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;we&#39;re living longer&quot;</span>,</a>
<a class="sourceLine" id="cb102-5" title="5">       <span class="dt">subtitle =</span> <span class="st">&quot;Biggest life expectancy rise, 1967-2007&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-3.svg" width="672" /></p>
</div>
<div id="直方图" class="section level2">
<h2><span class="header-section-number">4.5</span> 直方图</h2>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="co">## prepare data</span></a>
<a class="sourceLine" id="cb103-2" title="2">hist_df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb103-3" title="3"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>)</a>
<a class="sourceLine" id="cb103-4" title="4"></a>
<a class="sourceLine" id="cb103-5" title="5"></a>
<a class="sourceLine" id="cb103-6" title="6"><span class="co">## create plot</span></a>
<a class="sourceLine" id="cb103-7" title="7">hist_chart &lt;-<span class="st"> </span><span class="kw">ggplot</span>(hist_df) <span class="op">+</span></a>
<a class="sourceLine" id="cb103-8" title="8"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(lifeExp), <span class="dt">binwidth =</span> <span class="dv">5</span>, </a>
<a class="sourceLine" id="cb103-9" title="9">                 <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#1380A1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb103-10" title="10"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;#333333&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb103-11" title="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">35</span>, <span class="dv">95</span>),</a>
<a class="sourceLine" id="cb103-12" title="12">                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">40</span>, <span class="dv">90</span>, <span class="dt">by =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb103-13" title="13">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;40&quot;</span>, <span class="st">&quot;50&quot;</span>, <span class="st">&quot;60&quot;</span>, <span class="st">&quot;70&quot;</span>, <span class="st">&quot;80&quot;</span>, <span class="st">&quot;90 years&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb103-14" title="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;How life expectancy varies&quot;</span>,</a>
<a class="sourceLine" id="cb103-15" title="15">       <span class="dt">subtitle =</span> <span class="st">&quot;Distribution of life expectancy in 2007&quot;</span>)</a>
<a class="sourceLine" id="cb103-16" title="16"></a>
<a class="sourceLine" id="cb103-17" title="17">hist_chart</a></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.svg" width="672" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="co">## 添加 bbc_style()</span></a>
<a class="sourceLine" id="cb105-2" title="2">hist_chart <span class="op">+</span><span class="st"> </span><span class="kw">bbc_style</span>()</a></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-85-2.svg" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="others.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggdark.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
},
"toc_depth": 4
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
